<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<!-- / "Website Properties" -->
<meta content='Compose your infrastructure.' name='description'>
<meta content='spox' name='author'>
<link href='img/logo-full-color.png' rel='icon'>
<title>SparkleFormation: Tips and Tricks</title>
<!-- / "CSS resources" -->
<link href="/css/base.css" rel="stylesheet" />
<!-- / "JQuery" -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- / "Favicons" -->
<!-- / Favicons -->
<link href="/img/logo-full-color.png" rel="icon" type="image/png" />
<link href='/img/ico/favicon-144.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/img/ico/favicon-114.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/img/ico/favicon-72.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/img/ico/favicon-57.png' rel='apple-touch-icon-precomposed' sizes='57x57'>

<!-- / "OpenGraph" -->
<!-- / "See http://ogp.me/ for more information" -->
<meta content='http://www.sparkleformation.io/docs/guides/tips-and-tricks.html' name='og:url'>
<meta content='website' name='og:type'>
<meta content='SparkleFormation' name='og:site_name'>
<meta content='Tips and Tricks' name='og:title'>
<meta content='Compose your infrastructure.' name='og:description'>
<meta name='og:image'>
<meta name='og:audio'>
<meta name='og:video'>

<!-- / "HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries" -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>
<div class='navbar'>
<link href="/css/navbar.css" rel="stylesheet" />
<div class='navbar-fixed-top'>
<div class='container'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='fa fa-bars'></span>
</button>
<a class='navbar-brand brand' href='/'>
<img src='/img/logo-full-color.png'>
<span><span class=strong>Sparkle</span><span class=thin>Formation</span></span>
</a>
</div>
<div class='navbar-collapse collapse'>
<ul class='nav navbar-nav navbar-right'>
<li>
<a class='black' href='/#platforms'>
<span>Platforms</span>
</a>
</li>
<li>
<a class='black' href='/docs/'>
<span>Docs</span>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class='breadcrumbs'>
<link href="/css/breadcrumbs.css" rel="stylesheet" />
<div class='container'>
<div class='row'>
<div class='col-sm-offset-4 col-sm-8 col-md-offset-3 col-md-9'>
<ol class='list-inline'>
<li>
<a href='/docs/'>
<span class='black'>Documentation</span>
</a>
</li>
<li>
<a href='/docs/guides/'>
<span class='black'>Guides</span>
</a>
</li>
<li>
<a href='/docs/guides/tips-and-tricks.html'>
<span class='black'>Tips and Tricks</span>
</a>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class='documentation'>
<link href="/css/docs.css" rel="stylesheet" />
<div class='container'>
<div class='row'>
<div class='col-sm-4 col-md-3'>
<div class='sidebar'>
<link href="/css/sidebar.css" rel="stylesheet" />
<ul>
<li>
<a href='/docs/guides/'>Guides</a>
<ul>
<li>
<a href='/docs/guides/getting-started.html'>Getting Started</a>
</li>

<li>
<a href='/docs/guides/apply-and-nested.html'>Stack Dependencies</a>
</li>

<li>
<a href='/docs/guides/tips-and-tricks.html'>Tips and Tricks</a>
<ul>
<li>
<a href='/docs/guides/tips-and-tricks.html#stubbing-builtins'>Stubbing builtins</a>
</li>
<li>
<a href='/docs/guides/tips-and-tricks.html#resource-conflicts'>Resource conflicts</a>
</li>
</ul>
</li>

</ul>
</li>

<li>
<a href='/docs/sparkle_formation/'>SparkleFormation</a>
</li>

<li>
<a href='/docs/sfn/'>sfn</a>
</li>


</ul>
</div>

</div>
<div class='col-sm-8 col-md-9'>
<div class='documentation-content'>
<h2 id="stubbing-builtins">Stubbing builtins</h2>&#x000A;&#x000A;<p>SparkleFormation provides a number of builtin resources using the&#x000A;<code>dynamic!</code> helper. These known resources are collected when SparkleFormation&#x000A;is released. Because this is a static list of resource types it is&#x000A;common for new resources to be introduced within a cloud provider&#x000A;and not be available within SparkleFormation. Since the new resource&#x000A;types will not be available within SparkleFormation until the next&#x000A;release, stubbing the builtin will provide the same behavior as if&#x000A;it were included within the builtin list.</p>&#x000A;&#x000A;<p>For example, lets assume that AWS CloudFormation introduces a new&#x000A;resource type named <code>AWS::JVM::Instance</code>. To stub this resource a&#x000A;new dynamic can be created locally:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">SparkleFormation</span><span class="p">.</span><span class="nf">dynamic</span><span class="p">(</span><span class="ss">:jvm_instance</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>&#x000A;  <span class="n">resources</span><span class="p">.</span><span class="nf">set!</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">_jvm_instance"</span><span class="p">.</span><span class="nf">to_sym</span><span class="p">)</span> <span class="k">do</span>&#x000A;    <span class="n">type</span> <span class="s2">"AWS::JVM::Instance"</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>With this dynamic defined it will behave the same as if it were&#x000A;defined in the builtin list:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">SparkleFormation</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:test</span><span class="p">)</span> <span class="k">do</span>&#x000A;  <span class="n">dynamic!</span><span class="p">(</span><span class="ss">:jvm_instance</span><span class="p">,</span> <span class="ss">:test</span><span class="p">)</span> <span class="k">do</span>&#x000A;    <span class="n">properties</span><span class="p">.</span><span class="nf">memory</span> <span class="mi">512</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>which results in:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">&#x000A;  </span><span class="s2">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;    </span><span class="s2">"TestJvmInstance"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::JVM::Instance"</span><span class="p">,</span><span class="w">&#x000A;      </span><span class="s2">"Properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;        </span><span class="s2">"Memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">512</span><span class="w">&#x000A;      </span><span class="p">}</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;  </span><span class="p">}</span><span class="w">&#x000A;</span><span class="p">}</span><span class="w">&#x000A;</span></code></pre></div>&#x000A;<p>Once the <code>AWS::JVM::Instance</code> becomes available in the builtin&#x000A;list within SparkleFormation the custom stub dynamic can be deleted.</p>&#x000A;&#x000A;<h2 id="resource-conflicts">Resource conflicts</h2>&#x000A;&#x000A;<p>Resource conflicts can occur when the same resource name is used&#x000A;in multiple resource namespaces. If a template has created resources&#x000A;using the <code>dynamic!</code> helper and not included the resource’s namespace,&#x000A;conflicts will occur when the new resource becomes available. An&#x000A;example of this is the <code>AWS::ElasticLoadBalancing::LoadBalancer</code> resource.</p>&#x000A;&#x000A;<p>Assume that the following template is in use:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">SparkleFormation</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:lb</span><span class="p">)</span> <span class="k">do</span>&#x000A;  <span class="n">dynamic!</span><span class="p">(</span><span class="ss">:load_balancer</span><span class="p">,</span> <span class="ss">:app</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>and it generates:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">&#x000A;  </span><span class="s2">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;    </span><span class="s2">"AppLoadBalancer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::ElasticLoadBalancing::LoadBalancer"</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;  </span><span class="p">}</span><span class="w">&#x000A;</span><span class="p">}</span><span class="w">&#x000A;</span></code></pre></div>&#x000A;<p>Now, AWS releases a new resource with a conflicting name&#x000A;<code>AWS::ElasticLoadBalancingV2::LoadBalancer</code> and SparkleFormation’s internal&#x000A;resource list has been updated. When the template is run again, it returns&#x000A;an error about conflicting resource names. One solution is to update the&#x000A;<code>dynamic!</code> call to include the namespace:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">SparkleFormation</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:lb</span><span class="p">)</span> <span class="k">do</span>&#x000A;  <span class="n">dynamic!</span><span class="p">(</span><span class="ss">:elastic_load_balancing_load_balancer</span><span class="p">,</span> <span class="ss">:app</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>and it will then generate:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight json"><code><span class="p">{</span><span class="w">&#x000A;  </span><span class="s2">"Resources"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;    </span><span class="s2">"AppElasticLoadBalancingLoadBalancer"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;      </span><span class="s2">"Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS::ElasticLoadBalancing::LoadBalancer"</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;  </span><span class="p">}</span><span class="w">&#x000A;</span><span class="p">}</span><span class="w">&#x000A;</span></code></pre></div>&#x000A;<p>This resolves the conflict issue, yet in practice the modification of the&#x000A;resource name will likely cause issues in complex templates where the&#x000A;resource is being referenced in other locations. To allow templates to&#x000A;remain unchanged, a new dynamic can be introduced which will force matching&#x000A;of the <code>:load_balancer</code> name to the local dynamic:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">SparkleFormation</span><span class="p">.</span><span class="nf">dynamic</span><span class="p">(</span><span class="ss">:load_balancer</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span>&#x000A;  <span class="n">dynamic!</span><span class="p">(</span><span class="ss">:elastic_load_balancing_load_balancer</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="ss">:resource_name_suffix</span> <span class="o">=&gt;</span> <span class="ss">:load_balancer</span><span class="p">)</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>With this dynamic in place, all original templates will continue to behave&#x000A;as expected without individual modifications.</p>&#x000A;

</div>
</div>
</div>
</div>
</div>

<div class='footer section theme-bg-inverse'>
<link href="/css/section.css" rel="stylesheet" />
<link href="/css/footer.css" rel="stylesheet" />
<div class='container'>
<div class='row content-row'>
<div class='col-sm-2 col-sm-offset-0 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2'>
<div class='list'>
<div class='row'>
<link href="/css/list.css" rel="stylesheet" />
<div class='col-sm-12 list-column'>
<ul class='list-unstyled'>
<li>
<div class='white'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="/">Home</a></p>


</span>

</div>
</div>

</div>

</li>
<li>
<span>
<p><a href="/#components">Components</a></p>


</span>

</li>
<li>
<span>
<p><a href="/#features">Features</a></p>


</span>

</li>
<li>
<div class='white'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="/docs/">Docs</a></p>


</span>

</div>
</div>

</div>

</li>
<li>
<span>
<p><a href="/docs/guides/getting-started.html">Getting Started</a></p>


</span>

</li>
<li>
<span>
<p><a href="/docs/sparkle_formation/">Library &amp; DSL</a></p>


</span>

</li>
<li>
<span>
<p><a href="/docs/sfn/">CLI</a></p>


</span>

</li>
</ul>
</div>
</div>
</div>

</div>

</div>

<div class='text-center'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="https://twitter.com/sfnftw"><span class="social-icon fa fa-twitter"></span></a> <a href="https://github.com/sparkleformation"><span class="social-icon fa fa-github"></span></a></p>


</span>

<span>
<p>Made with <span class="fa fa-heart"></span> by <a href="https://github.com/chrisroberts">spox</a> © 2013-2019</p>


</span>

</div>
</div>

</div>

</div>
</div>


<tail>
<!-- / "JQuery + Bootstrap" -->
<script src="/js/bootstrap/bootstrap.js"></script>
<!-- / "IE10 viewport hack for Surface/desktop Windows 8 bug" -->
<script src="/js/ie10-viewport-bug-workaround.js"></script>
<!-- / "Google Analytics" -->

<!-- / "Twitter" -->

<!-- / "Auto loader for custom Javascript" -->
<!-- / = javascript_include_tag "all" -->
<script src="/js/sparkleformation.js"></script>
<script src="/js/typetype.min.js"></script>
</tail>

</body>
</html>
