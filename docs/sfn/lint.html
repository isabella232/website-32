<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<!-- / "Website Properties" -->
<meta content='Compose your infrastructure.' name='description'>
<meta content='spox' name='author'>
<link href='img/logo-full-color.png' rel='icon'>
<title>SparkleFormation: Lint</title>
<!-- / "CSS resources" -->
<link href="/css/base.css" rel="stylesheet" />
<!-- / "JQuery" -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- / "Favicons" -->
<!-- / Favicons -->
<link href="/img/logo-full-color.png" rel="icon" type="image/png" />
<link href='/img/ico/favicon-144.png' rel='apple-touch-icon-precomposed' sizes='144x144'>
<link href='/img/ico/favicon-114.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/img/ico/favicon-72.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/img/ico/favicon-57.png' rel='apple-touch-icon-precomposed' sizes='57x57'>

<!-- / "OpenGraph" -->
<!-- / "See http://ogp.me/ for more information" -->
<meta content='http://www.sparkleformation.io/docs/sfn/lint.html' name='og:url'>
<meta content='website' name='og:type'>
<meta content='SparkleFormation' name='og:site_name'>
<meta content='Lint' name='og:title'>
<meta content='Compose your infrastructure.' name='og:description'>
<meta name='og:image'>
<meta name='og:audio'>
<meta name='og:video'>

<!-- / "HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries" -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>
<div class='navbar'>
<link href="/css/navbar.css" rel="stylesheet" />
<div class='navbar-fixed-top'>
<div class='container'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-collapse' data-toggle='collapse' type='button'>
<span class='fa fa-bars'></span>
</button>
<a class='navbar-brand brand' href='/'>
<img src='/img/logo-full-color.png'>
<span><span class=strong>Sparkle</span><span class=thin>Formation</span></span>
</a>
</div>
<div class='navbar-collapse collapse'>
<ul class='nav navbar-nav navbar-right'>
<li>
<a class='black' href='/#platforms'>
<span>Platforms</span>
</a>
</li>
<li>
<a class='black' href='/docs/'>
<span>Docs</span>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>

<div class='breadcrumbs'>
<link href="/css/breadcrumbs.css" rel="stylesheet" />
<div class='container'>
<div class='row'>
<div class='col-sm-offset-4 col-sm-8 col-md-offset-3 col-md-9'>
<ol class='list-inline'>
<li>
<a href='/docs/'>
<span class='black'>Documentation</span>
</a>
</li>
<li>
<a href='/docs/sfn/'>
<span class='black'>sfn</span>
</a>
</li>
<li>
<a href='/docs/sfn/lint.html'>
<span class='black'>Lint</span>
</a>
</li>
</ol>
</div>
</div>
</div>
</div>

<div class='documentation'>
<link href="/css/docs.css" rel="stylesheet" />
<div class='container'>
<div class='row'>
<div class='col-sm-4 col-md-3'>
<div class='sidebar'>
<link href="/css/sidebar.css" rel="stylesheet" />
<ul>
<li>
<a href='/docs/guides/'>Guides</a>
</li>

<li>
<a href='/docs/sparkle_formation/'>SparkleFormation</a>
</li>

<li>
<a href='/docs/sfn/'>sfn</a>
<ul>
<li>
<a href='/docs/sfn/overview.html'>Overview</a>
</li>

<li>
<a href='/docs/sfn/configuration.html'>Configuration</a>
</li>

<li>
<a href='/docs/sfn/usage.html'>Usage</a>
</li>

<li>
<a href='/docs/sfn/commands.html'>CLI Commands</a>
</li>

<li>
<a href='/docs/sfn/sparkle-packs.html'>SparklePacks</a>
</li>

<li>
<a href='/docs/sfn/command-config.html'>Configuration</a>
</li>

<li>
<a href='/docs/sfn/callbacks.html'>Callbacks</a>
</li>

<li>
<a href='/docs/sfn/lint.html'>Lint</a>
<ul>
<li>
<a href='/docs/sfn/lint.html#lint-framework'>Lint Framework</a>
</li>
<li>
<a href='/docs/sfn/lint.html#composition'>Composition</a>
</li>
<li>
<a href='/docs/sfn/lint.html#usage'>Usage</a>
</li>
</ul>
</li>

</ul>
</li>


</ul>
</div>

</div>
<div class='col-sm-8 col-md-9'>
<div class='documentation-content'>
<h2 id="lint">Lint</h2>&#x000A;&#x000A;<p>The lint framework built within the sfn tool utilizes the <a href="http://jmespath.org/">JMESPath</a> query language&#x000A;for identifying patterns and apply validation rules.</p>&#x000A;&#x000A;<h3 id="lint-framework">Lint Framework</h3>&#x000A;&#x000A;<p>A rule set is a named collection of rules to be applied to a template. Each rule&#x000A;is composed of one or more definitions. A rule passes only if <em>all</em> definitions&#x000A;can be successfully applied. Linting related classes:</p>&#x000A;&#x000A;<ul>&#x000A;  <li><code>Sfn::Lint::RuleSet</code></li>&#x000A;  <li><code>Sfn::Lint::Rule</code></li>&#x000A;  <li><code>Sfn::Lint::Definition</code></li>&#x000A;</ul>&#x000A;&#x000A;<h3 id="composition">Composition</h3>&#x000A;&#x000A;<h4 id="long-form">Long Form</h4>&#x000A;&#x000A;<h5 id="sfnlintdefinition"><code>Sfn::Lint::Definition</code></h5>&#x000A;&#x000A;<p>Definitions define a search expression to be applied to a given template. The search&#x000A;expression is a <a href="http://jmespath.org/specification.html">JMESPath compatible query expression</a>. The matches&#x000A;of the search expression are then processed. If the results are valid, a <code>true</code> result&#x000A;is expected. If the results are invalid, a <code>false</code> value is expected, or an <code>Array&lt;String&gt;</code>&#x000A;value is expected which provides the list of invalid items.</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Definition</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Resources.[*][0][*].Type'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">matches</span><span class="p">,</span> <span class="n">template</span><span class="o">|</span>&#x000A;  <span class="k">unless</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">nil?</span><span class="p">)</span>&#x000A;    <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="o">!</span><span class="n">i</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'AWS'</span><span class="p">)}</span>&#x000A;    <span class="n">result</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">result</span>&#x000A;  <span class="k">else</span>&#x000A;    <span class="kp">true</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>The processing block is provided two arguments. The first is the match result of the&#x000A;search expression. The second is the full template <code>Hash</code> that is being processed.</p>&#x000A;&#x000A;<h5 id="sfnlintrule"><code>Sfn::Lint::Rule</code></h5>&#x000A;&#x000A;<p>Rules are composed of definitions. When a rule is applied to a template it will only&#x000A;pass if <em>all</em> definitions are successfully applied. A rule also includes a failure&#x000A;message to provide user context of the failure.</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="n">definition</span> <span class="o">=</span> <span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Definition</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Resources.[*][0][*].Type'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">matches</span><span class="p">,</span> <span class="n">template</span><span class="o">|</span>&#x000A;  <span class="k">unless</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">nil?</span><span class="p">)</span>&#x000A;    <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="o">!</span><span class="n">i</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'AWS'</span><span class="p">)}</span>&#x000A;    <span class="n">result</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">result</span>&#x000A;  <span class="k">else</span>&#x000A;    <span class="kp">true</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Rule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>&#x000A;  <span class="ss">:aws_resources_only</span><span class="p">,</span>&#x000A;  <span class="p">[</span><span class="n">definition</span><span class="p">],</span>&#x000A;  <span class="s1">'All types must be within AWS root namespace'</span>&#x000A;<span class="p">)</span>&#x000A;</code></pre></div>&#x000A;<h5 id="sfnlintruleset"><code>Sfn::Lint::RuleSet</code></h5>&#x000A;&#x000A;<p>A rule set is a named collection of rules. It allows logically grouping related&#x000A;rules together. Rule sets are the entry point of linting actions on templates. Once&#x000A;a rule set has been created, it must then be registered to be made available.</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="n">definition</span> <span class="o">=</span> <span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Definition</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Resources.[*][0][*].Type'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">matches</span><span class="p">,</span> <span class="n">template</span><span class="o">|</span>&#x000A;  <span class="k">unless</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">nil?</span><span class="p">)</span>&#x000A;    <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="o">!</span><span class="n">i</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'AWS'</span><span class="p">)}</span>&#x000A;    <span class="n">result</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">result</span>&#x000A;  <span class="k">else</span>&#x000A;    <span class="kp">true</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="n">rule</span> <span class="o">=</span> <span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">Rule</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>&#x000A;  <span class="ss">:aws_resources_only</span><span class="p">,</span>&#x000A;  <span class="p">[</span><span class="n">definition</span><span class="p">],</span>&#x000A;  <span class="s1">'All types must be within AWS root namespace'</span>&#x000A;<span class="p">)</span>&#x000A;&#x000A;<span class="n">rule_set</span> <span class="o">=</span> <span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">RuleSet</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:aws_rules</span><span class="p">,</span> <span class="p">[</span><span class="n">rule</span><span class="p">])</span>&#x000A;<span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">RuleSet</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">rule_set</span><span class="p">)</span>&#x000A;</code></pre></div>&#x000A;<h4 id="short-form">Short Form</h4>&#x000A;&#x000A;<p>Rule sets can also be created using a generator which reduces the amount of effort required&#x000A;for composition. The same rule set defined above can be created using the <code>RuleSet.build</code>&#x000A;generator:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="n">rule_set</span> <span class="o">=</span> <span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">RuleSet</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span><span class="ss">:aws_rules</span><span class="p">)</span> <span class="k">do</span>&#x000A;  <span class="n">rule</span> <span class="ss">:aws_resources_only</span> <span class="k">do</span>&#x000A;    <span class="n">definition</span> <span class="s1">'Resources.[*][0][*].Type'</span> <span class="k">do</span> <span class="o">|</span><span class="n">search</span><span class="o">|</span>&#x000A;      <span class="k">unless</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">nil?</span><span class="p">)</span>&#x000A;        <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="o">!</span><span class="n">i</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'AWS'</span><span class="p">)}</span>&#x000A;        <span class="n">result</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">result</span>&#x000A;      <span class="k">else</span>&#x000A;        <span class="kp">true</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="n">fail_message</span> <span class="s1">'All types must be within AWS root namespace'</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;<span class="no">Sfn</span><span class="o">::</span><span class="no">Lint</span><span class="o">::</span><span class="no">RuleSet</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">rule_set</span><span class="p">)</span>&#x000A;</code></pre></div>&#x000A;<h3 id="usage">Usage</h3>&#x000A;&#x000A;<p>Linting functionality is available via the <code>lint</code> command. The only requirement of the <code>lint</code>&#x000A;command is a template provided by the <code>--file</code> flag:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>$ sfn lint --file my-template&#x000A;</code></pre></div>&#x000A;<p>By default all registered rule sets applicable to the template will be applied. Rule sets can&#x000A;be disabled by name to prevent them from being applied:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>$ sfn lint --file my-template --disable-rule-set aws_rules&#x000A;</code></pre></div>&#x000A;<p>or you can explicitly specify what rule sets should be applied:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>$ sfn lint --file my-template --enable-rule-set aws_rules&#x000A;</code></pre></div>&#x000A;<h4 id="local-rule-sets">Local rule sets</h4>&#x000A;&#x000A;<p>Rule sets can be created for a local project. These rule sets are kept within a directory, and&#x000A;should be defined as a single rule set per file. For example, having a directory <code>tests/lint</code>&#x000A;the rule set can be created:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># tests/lint/resource_type_check.rb</span>&#x000A;<span class="no">RuleSet</span><span class="p">.</span><span class="nf">build</span><span class="p">(</span><span class="ss">:aws_rules</span><span class="p">)</span> <span class="k">do</span>&#x000A;  <span class="n">rule</span> <span class="ss">:aws_resources_only</span> <span class="k">do</span>&#x000A;    <span class="n">definition</span> <span class="s1">'Resources.[*][0][*].Type'</span> <span class="k">do</span> <span class="o">|</span><span class="n">search</span><span class="o">|</span>&#x000A;      <span class="k">unless</span><span class="p">(</span><span class="n">search</span><span class="p">.</span><span class="nf">nil?</span><span class="p">)</span>&#x000A;        <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="nf">find_all</span><span class="p">{</span><span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="o">!</span><span class="n">i</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'AWS'</span><span class="p">)}</span>&#x000A;        <span class="n">result</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="n">result</span>&#x000A;      <span class="k">else</span>&#x000A;        <span class="kp">true</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;&#x000A;    <span class="n">fail_message</span> <span class="s1">'All types must be within AWS root namespace'</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</code></pre></div>&#x000A;<p>To include the local rule sets the target directory must be provided:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>$ sfn lint --file my-template --lint-directory tests/lint&#x000A;</code></pre></div>&#x000A;<p>and if <em>only</em> local rule sets should be applied, it is possible to disable all registered&#x000A;rule sets:</p>&#x000A;&#x000A;<div class="highlight"><pre class="highlight plaintext"><code>$ sfn lint --file my-template --lint-directory tests/lint --local-rule-sets-only&#x000A;</code></pre></div>&#x000A;

</div>
</div>
</div>
</div>
</div>

<div class='footer section theme-bg-inverse'>
<link href="/css/section.css" rel="stylesheet" />
<link href="/css/footer.css" rel="stylesheet" />
<div class='container'>
<div class='row content-row'>
<div class='col-sm-2 col-sm-offset-0 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2 col-sm-offset-0 col-sm-2'>
<div class='list'>
<div class='row'>
<link href="/css/list.css" rel="stylesheet" />
<div class='col-sm-12 list-column'>
<ul class='list-unstyled'>
<li>
<div class='white'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="/">Home</a></p>


</span>

</div>
</div>

</div>

</li>
<li>
<span>
<p><a href="/#components">Components</a></p>


</span>

</li>
<li>
<span>
<p><a href="/#features">Features</a></p>


</span>

</li>
<li>
<div class='white'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="/docs/">Docs</a></p>


</span>

</div>
</div>

</div>

</li>
<li>
<span>
<p><a href="/docs/guides/getting-started.html">Getting Started</a></p>


</span>

</li>
<li>
<span>
<p><a href="/docs/sparkle_formation/">Library &amp; DSL</a></p>


</span>

</li>
<li>
<span>
<p><a href="/docs/sfn/">CLI</a></p>


</span>

</li>
</ul>
</div>
</div>
</div>

</div>

</div>

<div class='text-center'>
<div class='content-block'>
<link href="/css/content-block.css" rel="stylesheet" />

<div class='content-body'>
<span>
<p><a href="https://twitter.com/sfnftw"><span class="social-icon fa fa-twitter"></span></a> <a href="https://github.com/sparkleformation"><span class="social-icon fa fa-github"></span></a></p>


</span>

<span>
<p>Made with <span class="fa fa-heart"></span> by <a href="https://github.com/chrisroberts">spox</a> © 2013-2019</p>


</span>

</div>
</div>

</div>

</div>
</div>


<tail>
<!-- / "JQuery + Bootstrap" -->
<script src="/js/bootstrap/bootstrap.js"></script>
<!-- / "IE10 viewport hack for Surface/desktop Windows 8 bug" -->
<script src="/js/ie10-viewport-bug-workaround.js"></script>
<!-- / "Google Analytics" -->

<!-- / "Twitter" -->

<!-- / "Auto loader for custom Javascript" -->
<!-- / = javascript_include_tag "all" -->
<script src="/js/sparkleformation.js"></script>
<script src="/js/typetype.min.js"></script>
</tail>

</body>
</html>
